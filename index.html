<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hero RPG: Absolute Sovereign</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0d0d0f;
            --card: rgba(255, 255, 255, 0.08);
            --text: #ffffff;
            --hint: #aaaaaa;
            --btn: #3390ec;
            --btn-text: #ffffff;
            --gold: #f1c40f;
            --hp: #ff4757;
            --accent: #00d2ff;
            --piggy: #2ecc71;
            --streak: #e67e22;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 12px;
            padding-bottom: 100px;
            overflow-x: hidden;
        }

        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        @keyframes fly {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-100px) scale(1.5); }
        }
        .particle {
            position: fixed;
            pointer-events: none;
            z-index: 10000;
            animation: fly 0.8s ease-out forwards;
            font-size: 24px;
        }

        /* –ö–ê–†–¢–û–ß–ö–ò */
        .card {
            background: var(--card);
            border-radius: 24px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* –ì–ï–†–û–ô */
        .hero-section { text-align: center; padding: 10px 0; }
        .rank-badge {
            font-size: 10px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent);
            margin-bottom: 8px;
        }
        .avatar-container {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 55px;
            height: 80px;
            margin: 5px 0;
        }
        .equipment-slot { width: 40px; text-align: center; }

        /* –ü–†–û–ì–†–ï–°–°-–ë–ê–†–´ */
        .bar-container {
            background: rgba(0, 0, 0, 0.4);
            height: 10px;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .bar-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* –¢–ê–ë–´ */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding: 4px;
            scrollbar-width: none;
        }
        .tabs::-webkit-scrollbar { display: none; }
        .tab-btn {
            padding: 10px 20px;
            border-radius: 14px;
            background: var(--card);
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 12px;
            font-weight: 700;
            white-space: nowrap;
            transition: 0.2s;
        }
        .tab-btn.active {
            background: var(--btn);
            color: var(--btn-text);
            border-color: var(--btn);
            box-shadow: 0 4px 12px rgba(51, 144, 236, 0.4);
        }

        /* –ö–í–ï–°–¢–´ */
        .quest-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0.04);
            border-radius: 18px;
            margin-bottom: 10px;
            border-left: 5px solid var(--btn);
            transition: 0.3s;
        }
        .quest-item.completed {
            opacity: 0.5;
            filter: grayscale(0.8);
            border-left-color: #555;
        }
        .quest-info b { display: block; font-size: 15px; margin-bottom: 2px; }
        .quest-time {
            font-size: 11px;
            color: var(--accent);
            font-weight: 700;
            background: rgba(0, 210, 255, 0.1);
            padding: 2px 6px;
            border-radius: 6px;
        }

        /* –ö–ù–û–ü–ö–ò */
        .btn-add {
            background: var(--btn);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 18px;
            width: 100%;
            font-weight: 800;
            font-size: 16px;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(51, 144, 236, 0.3);
        }
        .action-btn {
            background: var(--btn);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 13px;
        }
        .del-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 8px;
            border-radius: 10px;
            font-size: 16px;
        }

        /* –ú–û–î–ê–õ–ö–ê */
        #planner-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg);
            z-index: 2000;
            display: none;
            padding: 24px;
            overflow-y: auto;
        }
        .input-group { margin-bottom: 16px; }
        label { display: block; font-size: 12px; color: var(--hint); margin-bottom: 6px; font-weight: 600; }
        input, select {
            width: 100%;
            padding: 14px;
            border-radius: 14px;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 15px;
        }

        .hidden { display: none; }

        /* SHOP */
        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            margin-bottom: 8px;
        }

        /* WEEK VIEW */
        .week-day-title {
            color: var(--accent);
            font-size: 13px;
            font-weight: 800;
            margin: 15px 0 8px 5px;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

<div class="card hero-section">
    <div id="hero-rank" class="rank-badge">–ù–û–í–ò–ß–û–ö</div>
    <div class="avatar-container">
        <span id="slot-head" class="equipment-slot"></span>
        <span id="hero-body">üë∂</span>
        <span id="slot-weapon" class="equipment-slot"></span>
    </div>
    <div style="font-size: 20px; font-weight: 900;">–£–†–û–í–ï–ù–¨ <span id="total-lvl">1</span></div>
    
    <div style="display: flex; justify-content: space-between; font-size: 12px; margin-top: 15px; font-weight: 700;">
        <span>‚ù§Ô∏è HP: <span id="hp-val">100</span></span>
        <span style="color: var(--gold);">üí∞ –ó–û–õ–û–¢–û: <span id="gold-val">0</span></span>
    </div>
    <div class="bar-container">
        <div id="hp-bar" class="bar-fill" style="background: var(--hp); width: 100%;"></div>
    </div>
</div>

<div class="tabs">
    <button class="tab-btn active" onclick="showTab('tasks')">–ö–í–ï–°–¢–´</button>
    <button class="tab-btn" onclick="showTab('piggy')">–ö–û–ü–ò–õ–ö–ê</button>
    <button class="tab-btn" onclick="showTab('shop')">–ú–ê–ì–ê–ó–ò–ù</button>
    <button class="tab-btn" onclick="showTab('hero')">–ü–ï–†–°–û–ù–ê–ñ</button>
</div>

<div id="tab-tasks">
    <div id="quest-list"></div>
    <button class="btn-add" onclick="openPlanner()">Ôºã –ù–û–í–´–ô –ö–í–ï–°–¢</button>
</div>

<div id="tab-piggy" class="hidden">
    <div class="card" style="border-color: var(--piggy); background: linear-gradient(145deg, rgba(46,204,113,0.1), transparent);">
        <h3 style="margin-top: 0; display: flex; align-items: center; gap: 8px;">üí∞ –†–µ–∞–ª—å–Ω–∞—è —Ü–µ–ª—å</h3>
        <div id="piggy-ui">
            <div id="piggy-empty">
                <p style="font-size: 13px; color: var(--hint);">–í—ã –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ —Ä–µ–∞–ª—å–Ω—É—é —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é —Ü–µ–ª—å. –ö–æ–ø–∏—Ç–µ –Ω–∞ –º–µ—á—Ç—É –≤ –∂–∏–∑–Ω–∏ –∏ —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–¥–µ—Å—å.</p>
                <button class="btn-add" onclick="setupPiggy()" style="background: var(--piggy);">–£–°–¢–ê–ù–û–í–ò–¢–¨ –¶–ï–õ–¨</button>
            </div>
            <div id="piggy-active" class="hidden">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <b id="piggy-title" style="font-size: 16px;">–ù–∞–∑–≤–∞–Ω–∏–µ</b>
                    <span id="piggy-numbers" style="font-weight: bold; color: var(--piggy);">0 / 0</span>
                </div>
                <div class="bar-container">
                    <div id="piggy-bar" class="bar-fill" style="background: var(--piggy);"></div>
                </div>
                <p style="font-size: 11px; color: var(--hint); margin: 10px 0;">–û—Ç–ª–æ–∂–∏–ª–∏ –¥–µ–Ω—å–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏? –í–Ω–µ—Å–∏—Ç–µ —Å—É–º–º—É –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ–ø—ã—Ç!</p>
                <button class="btn-add" onclick="depositPiggy()" style="background: var(--piggy); margin-bottom: 10px;">–í–ù–ï–°–¢–ò –°–£–ú–ú–£</button>
                <button onclick="resetPiggy()" style="background:none; border:none; color:rgba(255,255,255,0.2); width:100%; font-size:11px;">–£–¥–∞–ª–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ü–µ–ª—å</button>
            </div>
        </div>
    </div>
</div>

<div id="tab-shop" class="hidden">
    <div class="card">
        <h3 style="margin-top:0">–ê—Ä—Å–µ–Ω–∞–ª</h3>
        <div id="shop-items"></div>
    </div>
</div>

<div id="tab-hero" class="hidden">
    <div id="skills-list"></div>
    <div class="card" style="margin-top: 20px;">
        <h3 style="margin-top:0">–ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–µ–¥–µ–ª–∏</h3>
        <div id="week-view"></div>
    </div>
</div>

<div id="planner-modal">
    <h2 style="margin: 0 0 20px 0;">–ù–æ–≤—ã–π –∫–≤–µ—Å—Ç</h2>
    
    <div class="input-group">
        <label>–ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨?</label>
        <input type="text" id="p-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏...">
    </div>

    <div class="input-group">
        <label>–í–†–ï–ú–Ø (–ï–°–õ–ò –ï–°–¢–¨):</label>
        <div style="display: flex; gap: 10px;">
            <input type="time" id="p-start">
            <input type="time" id="p-end">
        </div>
    </div>

    <div class="input-group">
        <label>–î–ï–ù–¨ –ù–ï–î–ï–õ–ò:</label>
        <select id="p-day">
            <option value="0">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option><option value="1">–í—Ç–æ—Ä–Ω–∏–∫</option><option value="2">–°—Ä–µ–¥–∞</option>
            <option value="3">–ß–µ—Ç–≤–µ—Ä–≥</option><option value="4">–ü—è—Ç–Ω–∏—Ü–∞</option><option value="5">–°—É–±–±–æ—Ç–∞</option><option value="6">–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</option>
        </select>
    </div>

    <div class="input-group">
        <label>–°–§–ï–†–ê –î–ï–Ø–¢–ï–õ–¨–ù–û–°–¢–ò:</label>
        <select id="p-cat" onchange="toggleCustomCat(this.value)">
            <option value="money">üí∞ –î–µ–Ω—å–≥–∏ / –ö–∞—Ä—å–µ—Ä–∞</option>
            <option value="education">üéì –û–±—É—á–µ–Ω–∏–µ / –ú–æ–∑–≥</option>
            <option value="health">üí™ –ó–¥–æ—Ä–æ–≤—å–µ / –°–ø–æ—Ä—Ç</option>
            <option value="custom">‚ú® –°–í–û–Ø –°–§–ï–†–ê...</option>
        </select>
    </div>

    <div id="custom-cat-box" class="input-group hidden">
        <label>–ù–ê–ó–í–ê–ù–ò–ï –í–ê–®–ï–ô –°–§–ï–†–´:</label>
        <input type="text" id="p-custom-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–∏—Å–æ–≤–∞–Ω–∏–µ">
    </div>

    <button class="btn-add" onclick="saveTask()">–î–û–ë–ê–í–ò–¢–¨ –ö–í–ï–°–¢</button>
    <button onclick="closePlanner()" style="width:100%; background:none; border:none; color:var(--hint); margin-top:20px; font-weight:bold;">–û–¢–ú–ï–ù–ê</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const DAYS_NAMES = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];
    const SHOP_DATA = {
        'head_1': { name: '–°—Ç–∞–ª—å–Ω–æ–π —à–ª–µ–º', icon: 'ü™ñ', price: 600, slot: 'head' },
        'weapon_1': { name: '–ú–µ—á —Ä—ã—Ü–∞—Ä—è', icon: 'üó°Ô∏è', price: 1000, slot: 'weapon' },
        'weapon_2': { name: '–ü–æ—Å–æ—Ö –º–∞–≥–∞', icon: 'ü™Ñ', price: 1500, slot: 'weapon' }
    };

    let state = JSON.parse(localStorage.getItem('hero_v17_absolute')) || {
        gold: 0,
        hp: 100,
        skills: {
            money: { xp: 0, lvl: 1 },
            education: { xp: 0, lvl: 1 },
            health: { xp: 0, lvl: 1 }
        },
        quests: [],
        inventory: [],
        equipped: { head: null, weapon: null },
        piggy: { active: false, title: '', goal: 0, current: 0 }
    };

    function save() {
        localStorage.setItem('hero_v17_absolute', JSON.stringify(state));
        render();
    }

    function spawnGold(e) {
        if (!e) return;
        for (let i = 0; i < 8; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.innerText = 'üí∞';
            p.style.left = e.clientX + 'px';
            p.style.top = e.clientY + 'px';
            p.style.setProperty('--dir', Math.random() * 360 + 'deg');
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 800);
        }
    }

    function render() {
        // –†–µ–Ω–¥–µ—Ä –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
        document.getElementById('gold-val').innerText = state.gold;
        document.getElementById('hp-val').innerText = state.hp;
        document.getElementById('hp-bar').style.width = state.hp + '%';

        // –≠–≤–æ–ª—é—Ü–∏—è –∏ –ì–µ—Ä–æ–π
        let totalLvl = 0;
        for (let key in state.skills) totalLvl += state.skills[key].lvl;
        document.getElementById('total-lvl').innerText = totalLvl;
        
        const rank = totalLvl > 30 ? "–õ–ï–ì–ï–ù–î–ê" : (totalLvl > 15 ? "–ú–ê–°–¢–ï–†" : (totalLvl > 5 ? "–ì–ï–†–û–ô" : "–ù–û–í–ò–ß–û–ö"));
        const body = totalLvl > 30 ? "ü¶∏" : (totalLvl > 15 ? "‚öîÔ∏è" : (totalLvl > 5 ? "üèπ" : "üë∂"));
        document.getElementById('hero-rank').innerText = rank;
        document.getElementById('hero-body').innerText = body;

        // –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞
        document.getElementById('slot-head').innerText = state.equipped.head ? SHOP_DATA[state.equipped.head].icon : '';
        document.getElementById('slot-weapon').innerText = state.equipped.weapon ? SHOP_DATA[state.equipped.weapon].icon : '';

        // –ö–æ–ø–∏–ª–∫–∞
        if (state.piggy.active) {
            document.getElementById('piggy-empty').classList.add('hidden');
            document.getElementById('piggy-active').classList.remove('hidden');
            document.getElementById('piggy-title').innerText = state.piggy.title;
            document.getElementById('piggy-numbers').innerText = `${state.piggy.current} / ${state.piggy.goal}`;
            const progress = (state.piggy.current / state.piggy.goal) * 100;
            document.getElementById('piggy-bar').style.width = Math.min(100, progress) + '%';
        } else {
            document.getElementById('piggy-empty').classList.remove('hidden');
            document.getElementById('piggy-active').classList.add('hidden');
        }

        // –ö–≤–µ—Å—Ç—ã (–°–µ–≥–æ–¥–Ω—è)
        const todayIdx = (new Date().getDay() + 6) % 7;
        const todayQuests = state.quests.filter(q => parseInt(q.day) === todayIdx);
        todayQuests.sort((a, b) => (a.start || '99:99').localeCompare(b.start || '99:99'));

        let questHtml = '';
        todayQuests.forEach(q => {
            const globalIdx = state.quests.indexOf(q);
            questHtml += `
                <div class="quest-item ${q.done ? 'completed' : ''}">
                    <div class="quest-info">
                        ${q.start ? `<span class="quest-time">üïí ${q.start} ${q.end ? '- ' + q.end : ''}</span>` : ''}
                        <b>${q.title}</b>
                    </div>
                    <div>
                        ${q.done ? 
                            `<button class="del-btn" onclick="deleteQuest(${globalIdx})">üóëÔ∏è</button>` : 
                            `<button class="action-btn" onclick="completeQuest(event, ${globalIdx})">–ì–û–¢–û–í–û</button>`
                        }
                    </div>
                </div>
            `;
        });
        document.getElementById('quest-list').innerHTML = questHtml || '<p style="text-align:center; color:var(--hint); margin-top:20px;">–ó–∞–¥–∞—á –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ—Ç.</p>';

        // –ù–∞–≤—ã–∫–∏ (–≤–∫–ª–∞–¥–∫–∞ –ì–µ—Ä–æ–π)
        let skillsHtml = '';
        for (let key in state.skills) {
            skillsHtml += `
                <div class="card" onclick="removeSkill('${key}')">
                    <div style="display:flex; justify-content:space-between; font-size:12px; font-weight:800; margin-bottom:5px;">
                        <span>${key.toUpperCase()} (LVL ${state.skills[key].lvl})</span>
                        <span>${state.skills[key].xp}%</span>
                    </div>
                    <div class="bar-container">
                        <div class="bar-fill" style="width:${state.skills[key].xp}%; background:var(--btn);"></div>
                    </div>
                </div>
            `;
        }
        document.getElementById('skills-list').innerHTML = skillsHtml;

        // –ú–∞–≥–∞–∑–∏–Ω
        let shopHtml = '';
        for (let id in SHOP_DATA) {
            const item = SHOP_DATA[id];
            const isOwned = state.inventory.includes(id);
            const isEquipped = state.equipped[item.slot] === id;
            
            shopHtml += `
                <div class="shop-item">
                    <span>${item.icon} ${item.name}</span>
                    <button class="action-btn" onclick="handleShop('${id}')" style="background:${isOwned ? (isEquipped ? 'var(--hp)' : 'var(--btn)') : 'var(--gold)'}; color:${isOwned ? 'white' : 'black'}">
                        ${isOwned ? (isEquipped ? '–°–ù–Ø–¢–¨' : '–ù–ê–î–ï–¢–¨') : item.price + ' üí∞'}
                    </button>
                </div>
            `;
        }
        document.getElementById('shop-items').innerHTML = shopHtml;

        // –ö–∞–ª–µ–Ω–¥–∞—Ä—å
        let weekHtml = '';
        DAYS_NAMES.forEach((dayName, i) => {
            const dayQs = state.quests.filter(q => parseInt(q.day) === i);
            if (dayQs.length > 0) {
                weekHtml += `<div class="week-day-title">${dayName}</div>`;
                dayQs.forEach(q => {
                    weekHtml += `<div style="font-size:12px; padding:4px 0; border-bottom:1px solid rgba(255,255,255,0.03); opacity:${q.done ? 0.4 : 1}">
                        <span style="color:var(--accent)">${q.start || '--:--'}</span> ${q.title}
                    </div>`;
                });
            }
        });
        document.getElementById('week-view').innerHTML = weekHtml || '<p style="text-align:center; font-size:12px; color:var(--hint);">–ü–ª–∞–Ω—ã –Ω–∞ –Ω–µ–¥–µ–ª—é –ø—É—Å—Ç—ã</p>';
    }

    // –õ–û–ì–ò–ö–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
    window.openPlanner = () => document.getElementById('planner-modal').style.display = 'block';
    window.closePlanner = () => document.getElementById('planner-modal').style.display = 'none';
    window.toggleCustomCat = (val) => document.getElementById('custom-cat-box').classList.toggle('hidden', val !== 'custom');

    window.saveTask = () => {
        const title = document.getElementById('p-title').value;
        if (!title) return;

        let cat = document.getElementById('p-cat').value;
        if (cat === 'custom') {
            cat = document.getElementById('p-custom-name').value || '–†–∞–∑–Ω–æ–µ';
            if (!state.skills[cat]) state.skills[cat] = { xp: 0, lvl: 1 };
        }

        state.quests.push({
            title,
            start: document.getElementById('p-start').value,
            end: document.getElementById('p-end').value,
            day: document.getElementById('p-day').value,
            cat: cat,
            done: false
        });

        document.getElementById('p-title').value = '';
        closePlanner();
        save();
    };

    window.completeQuest = (e, idx) => {
        spawnGold(e);
        state.quests[idx].done = true;
        state.gold += 50;
        
        const cat = state.quests[idx].cat;
        if (state.skills[cat]) {
            state.skills[cat].xp += 25;
            if (state.skills[cat].xp >= 100) {
                state.skills[cat].xp = 0;
                state.skills[cat].lvl++;
                tg.HapticFeedback.notificationOccurred('success');
            }
        }
        save();
    };

    window.deleteQuest = (idx) => {
        state.quests.splice(idx, 1);
        save();
    };

    window.removeSkill = (key) => {
        if (['money', 'education', 'health'].includes(key)) return;
        if (confirm(`–£–¥–∞–ª–∏—Ç—å —Å—Ñ–µ—Ä—É "${key}"?`)) {
            delete state.skills[key];
            save();
        }
    };

    // –§–ò–ù–ê–ù–°–´
    window.setupPiggy = () => {
        const t = prompt("–ù–∞ —á—Ç–æ –≤—ã –∫–æ–ø–∏—Ç–µ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏?", "–ù–∞–ø—Ä–∏–º–µ—Ä: PlayStation 5");
        const g = parseInt(prompt("–ö–∞–∫—É—é —Å—É–º–º—É –Ω—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å?", "50000"));
        if (t && g) {
            state.piggy = { active: true, title: t, goal: g, current: 0 };
            save();
        }
    };

    window.depositPiggy = () => {
        const amount = parseInt(prompt("–ö–∞–∫—É—é —Å—É–º–º—É –≤—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç–ª–æ–∂–∏–ª–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏?", "1000"));
        if (amount > 0) {
            state.piggy.current += amount;
            state.skills.money.xp += 20; // –ë–æ–Ω—É—Å –∑–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É
            if (state.skills.money.xp >= 100) {
                state.skills.money.xp = 0;
                state.skills.money.lvl++;
            }
            save();
        }
    };

    window.resetPiggy = () => {
        if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é —Ü–µ–ª—å?")) {
            state.piggy.active = false;
            save();
        }
    };

    // –ú–ê–ì–ê–ó–ò–ù
    window.handleShop = (id) => {
        const item = SHOP_DATA[id];
        if (state.inventory.includes(id)) {
            // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å - –Ω–∞–¥–µ–≤–∞–µ–º/—Å–Ω–∏–º–∞–µ–º
            if (state.equipped[item.slot] === id) {
                state.equipped[item.slot] = null;
            } else {
                state.equipped[item.slot] = id;
            }
        } else {
            // –ü–æ–∫—É–ø–∫–∞
            if (state.gold >= item.price) {
                state.gold -= item.price;
                state.inventory.push(id);
                state.equipped[item.slot] = id;
                tg.HapticFeedback.impactOccurred('medium');
            } else {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!");
            }
        }
        save();
    };

    window.showTab = (t) => {
        document.querySelectorAll('[id^="tab-"]').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + t).classList.remove('hidden');
        event.currentTarget.classList.add('active');
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    render();
</script>
</body>
</html>
