<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hero Life RPG</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: var(--tg-theme-bg-color, #1a1a1a);
            --text: var(--tg-theme-text-color, #ffffff);
            --hint: var(--tg-theme-hint-color, #aaaaaa);
            --btn: var(--tg-theme-button-color, #3390ec);
            --btn-text: var(--tg-theme-button-text-color, #ffffff);
            --hp-color: #ff4757;
            --gold-color: #ffa502;
        }

        body { background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 16px; overflow-x: hidden; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card { background: rgba(255,255,255,0.08); border-radius: 16px; padding: 16px; margin-bottom: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        
        /* –ó–¥–æ—Ä–æ–≤—å–µ –∏ –ó–æ–ª–æ—Ç–æ */
        .header-stats { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .stat-item { text-align: center; flex: 1; }
        .stat-val { font-size: 20px; font-weight: bold; display: block; }
        .stat-label { font-size: 12px; color: var(--hint); text-transform: uppercase; }

        /* –ü–æ–ª–æ—Å–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
        .skill-row { margin-bottom: 12px; }
        .skill-info { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px; }
        .bar-bg { background: rgba(255,255,255,0.1); height: 8px; border-radius: 4px; overflow: hidden; }
        .bar-fill { height: 100%; width: 0%; transition: width 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        /* –ö–≤–µ—Å—Ç—ã */
        .quest-item { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--btn); }
        .quest-item.done { opacity: 0.4; border-left-color: #2ed573; }
        .quest-text { font-size: 15px; font-weight: 500; }

        /* –ö–Ω–æ–ø–∫–∏ */
        button { background: var(--btn); color: var(--btn-text); border: none; padding: 12px; border-radius: 12px; width: 100%; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.1s; }
        button:active { transform: scale(0.98); }
        .btn-done { width: 50px; padding: 6px; font-size: 14px; }

        /* –ú–æ–¥–∞–ª–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ */
        #planner { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 1000; display: none; padding: 20px; box-sizing: border-box; }
        input, select { width: 100%; padding: 14px; margin-bottom: 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2); color: #fff; font-size: 16px; }
        
        .empty-state { text-align: center; color: var(--hint); padding: 40px 0; }
    </style>
</head>
<body>

<div id="app">
    <div class="header-stats">
        <div class="stat-item">
            <span class="stat-val" id="hp-text" style="color: var(--hp-color);">100</span>
            <span class="stat-label">‚ù§Ô∏è HP</span>
        </div>
        <div class="stat-item">
            <span class="stat-val" id="gold-text" style="color: var(--gold-color);">0</span>
            <span class="stat-label">üí∞ –ó–æ–ª–æ—Ç–æ</span>
        </div>
    </div>

    <div class="card">
        <div id="skills-container"></div>
    </div>

    <h3 style="margin-left: 8px;">‚öîÔ∏è –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã</h3>
    <div id="quest-list"></div>

    <button onclick="togglePlanner(true)" style="margin-top: 20px;">üìù –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–¥–µ–ª—é</button>
</div>

<div id="planner">
    <h2>–ù–æ–≤—ã–π –∫–≤–µ—Å—Ç</h2>
    <input type="text" id="q-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –¥–µ–ª–∞...">
    <select id="q-cat">
        <option value="money">üí∞ –î–µ–Ω—å–≥–∏</option>
        <option value="education">üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
        <option value="health">üí™ –§–∏–∑. —Ñ–æ—Ä–º–∞</option>
        <option value="english">üá¨üáß –ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
    </select>
    <button onclick="addQuest()">–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫</button>
    
    <div id="temp-preview" style="margin: 20px 0; max-height: 200px; overflow-y: auto;"></div>
    
    <button onclick="saveQuests()" style="background: #2ed573;">üöÄ –ù–∞—á–∞—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ</button>
    <button onclick="togglePlanner(false)" style="background: transparent; color: var(--hint); margin-top: 10px;">–ù–∞–∑–∞–¥</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –ø–∞–º—è—Ç–∏ –Ω–µ—Ç)
    let state = JSON.parse(localStorage.getItem('heroState')) || {
        hp: 100,
        gold: 0,
        skills: {
            money: { xp: 0, lvl: 1, name: '–î–µ–Ω—å–≥–∏', color: '#ffa502' },
            education: { xp: 0, lvl: 1, name: '–ó–Ω–∞–Ω–∏—è', color: '#1e90ff' },
            health: { xp: 0, lvl: 1, name: '–°–∏–ª–∞', color: '#ff4757' },
            english: { xp: 0, lvl: 1, name: 'English', color: '#a29bfe' }
        },
        quests: []
    };

    let tempQuests = [];

    function saveToStorage() {
        localStorage.setItem('heroState', JSON.stringify(state));
        render();
    }

    function render() {
        // –†–µ–Ω–¥–µ—Ä HP –∏ –ó–æ–ª–æ—Ç–∞
        document.getElementById('hp-text').innerText = state.hp;
        document.getElementById('gold-text').innerText = state.gold;

        // –†–µ–Ω–¥–µ—Ä –ù–∞–≤—ã–∫–æ–≤
        const skillHTML = Object.keys(state.skills).map(key => {
            const s = state.skills[key];
            return `
                <div class="skill-row">
                    <div class="skill-info">
                        <span>${s.name} (–£—Ä. ${s.lvl})</span>
                        <span>${s.xp}/100 XP</span>
                    </div>
                    <div class="bar-bg">
                        <div class="bar-fill" style="width: ${s.xp}%; background: ${s.color};"></div>
                    </div>
                </div>
            `;
        }).join('');
        document.getElementById('skills-container').innerHTML = skillHTML;

        // –†–µ–Ω–¥–µ—Ä –ö–≤–µ—Å—Ç–æ–≤
        const questList = document.getElementById('quest-list');
        if (state.quests.length === 0) {
            questList.innerHTML = '<div class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞—á. –í—Ä–µ–º—è –æ—Ç–¥—ã—Ö–∞—Ç—å! üò¥</div>';
        } else {
            questList.innerHTML = state.quests.map((q, idx) => `
                <div class="quest-item ${q.done ? 'done' : ''}">
                    <span class="quest-text">${q.title}</span>
                    ${q.done ? '‚úÖ' : `<button class="btn-done" onclick="completeQuest(${idx})">OK</button>`}
                </div>
            `).join('');
        }
    }

    function togglePlanner(show) {
        document.getElementById('planner').style.display = show ? 'block' : 'none';
        if(show) tg.BackButton.show(); else tg.BackButton.hide();
    }

    tg.BackButton.onClick(() => togglePlanner(false));

    function addQuest() {
        const title = document.getElementById('q-title').value;
        const cat = document.getElementById('q-cat').value;
        if (!title) return;

        tempQuests.push({ title, cat, done: false });
        document.getElementById('temp-preview').innerHTML += `<div style="padding:5px;">‚Ä¢ ${title}</div>`;
        document.getElementById('q-title').value = '';
        tg.HapticFeedback.impactOccurred('light');
    }

    function saveQuests() {
        if (tempQuests.length === 0) return;
        state.quests = [...state.quests, ...tempQuests];
        tempQuests = [];
        document.getElementById('temp-preview').innerHTML = '';
        togglePlanner(false);
        saveToStorage();
    }

    window.completeQuest = function(idx) {
        const q = state.quests[idx];
        if (q.done) return;

        q.done = true;
        state.gold += 50;
        
        // –ü—Ä–æ–∫–∞—á–∫–∞ –Ω–∞–≤—ã–∫–∞
        const skill = state.skills[q.cat];
        skill.xp += 25;
        if (skill.xp >= 100) {
            skill.xp = 0;
            skill.lvl += 1;
            tg.HapticFeedback.notificationOccurred('success');
            alert('–£–†–û–í–ï–ù–¨ –ü–û–í–´–®–ï–ù! üéâ');
        }

        tg.HapticFeedback.impactOccurred('medium');
        saveToStorage();
    };

    // –ü–µ—Ä–≤–∏—á–Ω—ã–π –∑–∞–ø—É—Å–∫
    render();
</script>

</body>
</html>
