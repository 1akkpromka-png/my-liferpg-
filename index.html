<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hero Life RPG v2</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: var(--tg-theme-bg-color, #1a1a1a);
            --text: var(--tg-theme-text-color, #ffffff);
            --hint: var(--tg-theme-hint-color, #aaaaaa);
            --btn: var(--tg-theme-button-color, #3390ec);
            --btn-text: var(--tg-theme-button-text-color, #ffffff);
            --hp-color: #ff4757;
            --gold-color: #ffa502;
        }

        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding: 16px; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ */
        .character-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        #hero-avatar { font-size: 80px; display: block; margin-bottom: 10px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.2)); }
        #hero-rank { font-weight: bold; font-size: 18px; color: var(--gold-color); display: block; }
        #total-lvl { font-size: 12px; color: var(--hint); }

        .card { background: rgba(255,255,255,0.08); border-radius: 16px; padding: 16px; margin-bottom: 16px; }
        
        .header-stats { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .stat-item { text-align: center; flex: 1; }
        .stat-val { font-size: 20px; font-weight: bold; display: block; }

        .skill-row { margin-bottom: 12px; }
        .skill-info { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px; }
        .bar-bg { background: rgba(255,255,255,0.1); height: 8px; border-radius: 4px; overflow: hidden; }
        .bar-fill { height: 100%; width: 0%; transition: width 0.6s ease-out; }

        .quest-item { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--btn); }
        .quest-item.done { opacity: 0.4; border-left-color: #2ed573; }

        button { background: var(--btn); color: var(--btn-text); border: none; padding: 12px; border-radius: 12px; width: 100%; font-size: 16px; font-weight: bold; }
        .btn-done { width: 60px; padding: 8px; font-size: 12px; }

        #planner { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 1000; display: none; padding: 20px; box-sizing: border-box; }
        input, select { width: 100%; padding: 14px; margin-bottom: 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2); color: #fff; }
    </style>
</head>
<body>

<div id="app">
    <div class="character-card">
        <span id="hero-avatar">üë∂</span>
        <span id="hero-rank">–ù–æ–≤–∏—á–æ–∫</span>
        <span id="total-lvl">–û–±—â–∏–π —É—Ä–æ–≤–µ–Ω—å: 1</span>
    </div>

    <div class="header-stats">
        <div class="stat-item">
            <span class="stat-val" id="hp-text" style="color: var(--hp-color);">100</span>
            <span style="font-size:12px;color:var(--hint)">‚ù§Ô∏è HP</span>
        </div>
        <div class="stat-item">
            <span class="stat-val" id="gold-text" style="color: var(--gold-color);">0</span>
            <span style="font-size:12px;color:var(--hint)">üí∞ –ó–û–õ–û–¢–û</span>
        </div>
    </div>

    <div class="card" id="skills-container"></div>

    <h3 style="margin-left: 8px;">‚öîÔ∏è –¢–µ–∫—É—â–∏–µ –∫–≤–µ—Å—Ç—ã</h3>
    <div id="quest-list"></div>

    <button onclick="togglePlanner(true)" style="margin-top: 20px;">üìù –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–µ–ª–∞</button>
</div>

<div id="planner">
    <h2>–ù–æ–≤—ã–π –∫–≤–µ—Å—Ç</h2>
    <input type="text" id="q-title" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?">
    <select id="q-cat">
        <option value="money">üí∞ –î–µ–Ω—å–≥–∏</option>
        <option value="education">üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
        <option value="health">üí™ –§–∏–∑. —Ñ–æ—Ä–º–∞</option>
        <option value="english">üá¨üáß –ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
    </select>
    <button onclick="addQuest()">–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫</button>
    <div id="temp-preview" style="margin: 20px 0; color: var(--hint);"></div>
    <button onclick="saveQuests()" style="background: #2ed573;">üöÄ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button onclick="togglePlanner(false)" style="background: transparent; color: var(--hint); margin-top: 10px;">–ù–∞–∑–∞–¥</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let state = JSON.parse(localStorage.getItem('heroStateV2')) || {
        hp: 100,
        gold: 0,
        skills: {
            money: { xp: 0, lvl: 1, name: '–î–µ–Ω—å–≥–∏', color: '#ffa502' },
            education: { xp: 0, lvl: 1, name: '–ó–Ω–∞–Ω–∏—è', color: '#1e90ff' },
            health: { xp: 0, lvl: 1, name: '–°–∏–ª–∞', color: '#ff4757' },
            english: { xp: 0, lvl: 1, name: 'English', color: '#a29bfe' }
        },
        quests: []
    };

    function save() {
        localStorage.setItem('heroStateV2', JSON.stringify(state));
        render();
    }

    function render() {
        document.getElementById('hp-text').innerText = state.hp;
        document.getElementById('gold-text').innerText = state.gold;

        // –†–∞—Å—á–µ—Ç –æ–±—â–µ–≥–æ —É—Ä–æ–≤–Ω—è –∏ —ç–≤–æ–ª—é—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        let totalLvl = 0;
        for (let s in state.skills) totalLvl += state.skills[s].lvl;
        document.getElementById('total-lvl').innerText = `–û–±—â–∏–π —É—Ä–æ–≤–µ–Ω—å: ${totalLvl}`;

        const avatar = document.getElementById('hero-avatar');
        const rank = document.getElementById('hero-rank');

        if (totalLvl <= 5) {
            avatar.innerText = "üë∂"; rank.innerText = "–ù–æ–≤–∏—á–æ–∫";
        } else if (totalLvl <= 15) {
            avatar.innerText = "üèπ"; rank.innerText = "–ò—Å–∫–∞—Ç–µ–ª—å";
        } else if (totalLvl <= 30) {
            avatar.innerText = "‚öîÔ∏è"; rank.innerText = "–í–æ–∏–Ω —Å–≤–µ—Ç–∞";
        } else {
            avatar.innerText = "üßô‚Äç‚ôÇÔ∏è"; rank.innerText = "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ú–∞–≥–∏—Å—Ç—Ä";
        }

        const skillHTML = Object.keys(state.skills).map(key => {
            const s = state.skills[key];
            return `
                <div class="skill-row">
                    <div class="skill-info"><span>${s.name} (Lvl ${s.lvl})</span><span>${s.xp}/100</span></div>
                    <div class="bar-bg"><div class="bar-fill" style="width:${s.xp}%; background:${s.color};"></div></div>
                </div>`;
        }).join('');
        document.getElementById('skills-container').innerHTML = skillHTML;

        document.getElementById('quest-list').innerHTML = state.quests.length ? state.quests.map((q, i) => `
            <div class="quest-item ${q.done ? 'done' : ''}">
                <span>${q.title}</span>
                ${q.done ? '‚úÖ' : `<button class="btn-done" onclick="complete(${i})">+XP</button>`}
            </div>`).join('') : '<div style="text-align:center;color:var(--hint);padding:20px;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</div>';
    }

    function togglePlanner(s) { document.getElementById('planner').style.display = s ? 'block' : 'none'; }
    
    let temp = [];
    function addQuest() {
        const t = document.getElementById('q-title').value;
        if (!t) return;
        temp.push({ title: t, cat: document.getElementById('q-cat').value, done: false });
        document.getElementById('temp-preview').innerHTML += `‚Ä¢ ${t}<br>`;
        document.getElementById('q-title').value = '';
    }

    function saveQuests() {
        state.quests = [...state.quests, ...temp];
        temp = [];
        document.getElementById('temp-preview').innerHTML = '';
        togglePlanner(false);
        save();
    }

    window.complete = function(i) {
        if (state.quests[i].done) return;
        state.quests[i].done = true;
        state.gold += 50;
        const s = state.skills[state.quests[i].cat];
        s.xp += 25;
        if (s.xp >= 100) { s.xp = 0; s.lvl++; tg.HapticFeedback.notificationOccurred('success'); }
        tg.HapticFeedback.impactOccurred('medium');
        save();
    };

    render();
</script>
</body>
</html>
